{% extends "base/base.html" %}
{% load static %}

{% block title %}Provider Profile: {{ provider.user.get_full_name }}{% endblock %}
{% block page_heading %}Provider Profile & Verification{% endblock %}

{% block content %}
    <div class="profile-header-status">
        <h2>{{ provider.user.get_full_name }} (SP-{{ provider.pk }})</h2>
        <div class="status-badge status-{{ provider.is_verified|yesno:'approved,pending' }}">
            Status: **{{ provider.is_verified|yesno:"VERIFIED,PENDING REVIEW" }}**
        </div>
    </div>

    <div class="profile-grid">
        <!-- Column 1: Core Details and Performance -->
        <div class="panel details-panel">
            <h3>Operational Details</h3>
            <p><strong>Primary Service:</strong> {{ provider.get_primary_service_display }}</p>
            <p><strong>Vehicle Type:</strong> {{ provider.vehicle_type }}</p>
            <p><strong>License Plate:</strong> <span class="highlight">{{ provider.license_plate }}</span></p>
            <p><strong>Service Radius:</strong> {{ provider.service_radius_km }} km</p>
            <p><strong>Bank A/C:</strong> {{ provider.bank_account_number|default:'N/A' }}</p>
            
            <h3 style="margin-top: 20px;">Performance Metrics</h3>
            <div class="kpi-group">
                <p><strong>Average Rating:</strong> <span class="kpi-value">{{ provider.average_rating|floatformat:1 }} â˜…</span></p>
                <p><strong>Total Jobs:</strong> <span class="kpi-value">{{ provider.total_jobs }}</span></p>
                <p><strong>Cancellation Rate:</strong> <span class="kpi-value">{{ provider.cancellation_rate }}%</span></p>
            </div>
        </div>

        <!-- Column 2: Document Verification and Action -->
        <div class="panel verification-panel">
            <h3>Document Review</h3>
            
            <table class="data-table doc-table">
                <thead>
                    <tr><th>Document</th><th>Status</th><th>Action</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Driver's License (Commercial)</td>
                        <td><span class="status-badge status-approved">Verified</span></td>
                        <td><a href="{{ provider.license_doc_url }}" target="_blank" class="btn btn-sm btn-view">View</a></td>
                    </tr>
                    <tr>
                        <td>Aadhaar/PAN (KYC)</td>
                        <td><span class="status-badge status-approved">Verified</span></td>
                        <td><a href="{{ provider.kyc_doc_url }}" target="_blank" class="btn btn-sm btn-view">View</a></td>
                    </tr>
                    <tr>
                        <td>Vehicle Registration (RC)</td>
                        <td><span class="status-badge status-pending">Pending</span></td>
                        <td><a href="{{ provider.rc_doc_url }}" target="_blank" class="btn btn-sm btn-view">View</a></td>
                    </tr>
                </tbody>
            </table>
            
            <h3 style="margin-top: 30px;">Verification Action</h3>
            <form method="POST" action="{% url 'admin_provider_verify_action' provider.pk %}">
                {% csrf_token %}
                <label for="verification_status">Set Final Status:</label>
                <select id="verification_status" name="status" class="form-control">
                    <option value="PENDING" {% if not provider.is_verified %}selected{% endif %}>Pending Review</option>
                    <option value="APPROVED">APPROVED (Activate Account)</option>
                    <option value="REJECTED">REJECTED (Permanent Block)</option>
                    <option value="SUSPENDED">SUSPENDED (Temporary Block)</option>
                </select>
                
                <label for="admin_notes">Notes (Mandatory for Reject/Suspend):</label>
                <textarea id="admin_notes" name="notes" rows="3"></textarea>
                
                <button type="submit" class="btn btn-primary btn-lg" style="margin-top: 15px;">Update Verification Status</button>
            </form>
        </div>
    </div>
{% endblock %}
