{% extends "base/base.html" %}
{% load static %}

{% block title %}Live Dispatch Console{% endblock %}
{% block page_heading %}Live Dispatch Map & Provider Assignment{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/helpline_agent.css' %}">
{% endblock %}

{% block content %}
    <div class="dispatch-map-grid">
        <!-- Map Container (Takes up 80% of the screen) -->
        <div id="live-map-container" class="map-full-panel">
            <p class="map-loading">Loading real-time provider and request data...</p>
            <!-- Map API will render here -->
        </div>

        <!-- Request Queue (Takes up 20% of the screen) -->
        <div class="request-queue-panel">
            <h3>Pending Requests ({{ pending_requests|length }})</h3>
            <div class="queue-filter">
                <button class="btn btn-sm btn-primary">High Priority ({{ urgent_requests|length }})</button>
                <button class="btn btn-sm btn-secondary">All</button>
            </div>

            <ul id="pending-request-list" class="request-list">
                {% for request in pending_requests %}
                <li class="request-item request-priority-{{ request.priority_level }}" data-request-id="{{ request.pk }}">
                    <span class="request-icon"><i class="icon-car"></i></span>
                    <div class="request-details">
                        <p class="request-type">{{ request.service_type_display }}</p>
                        <p class="request-location">{{ request.address_summary }}</p>
                        <p class="request-time">Received {{ request.time_ago }} ago</p>
                    </div>
                    <button class="btn btn-sm btn-assign" onclick="startManualAssignment({{ request.pk }})">Assign</button>
                </li>
                {% empty %}
                <li class="text-center empty-queue">No pending requests at this time.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/dispatch_map.js' %}"></script>
<!-- Note: This map logic will rely heavily on WebSockets (Channels) to update provider locations. -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GMAPS_KEY&callback=initLiveMap"></script>
{% endblock %}
